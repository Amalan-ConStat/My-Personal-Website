---
title: 'Week 9 : French Train Delays'
author: M.Amalan
date: '2019-02-28'
slug: Week9
ouptut:
  blogdown::html_page:
    toc: true
categories:
  - TidyTuesday
tags:
  - tidyverse
  - TidyTuesday
  - gganimate
image:
  caption: ''
  focal_point: ''
summary: "2019 Week 9 TidyTuesday: Train Delays in French Land"  
---



<pre class="r"><code># load the packages
library(readr)
library(tidyverse)
library(gganimate)
library(ggalluvial)
library(geomnet)
library(ggthemr)

# load the theme
ggthemr(&quot;fresh&quot;)

# load the data
small_trains &lt;- read_csv(&quot;small_trains.csv&quot;)</code></pre>
<div id="network-graph-for-the-french-city-trains" class="section level1">
<h1>Network Graph for the French City Trains</h1>
<p>Simply drawing a network graph to understand which french cities are mainly urban with capacity to trains arriving and departuring. Cities such as Paris Lyon, Paris Montparnasse, Paris Nord and Paris Est could be cities of concern with much for traffic with related to trains.</p>
<pre class="r"><code>ggplot(small_trains,aes(from_id=departure_station,to_id=arrival_station))+
          geom_net(directed = TRUE,labelon = TRUE,size=0.5,labelcolour = &quot;black&quot;,
                   repel = FALSE,ecolour = &quot;grey70&quot;, arrowsize = 0.75,
                   linewidth = 0.5,layout.alg = &quot;fruchtermanreingold&quot;)+
          theme_net()+
          ggtitle(&quot;Network Graph Showing from City to City of French Trains&quot;)</code></pre>
<p><img src="/post/TidyTuesday2019/Week9/index_files/figure-html/network%20graph-1.png" width="1344" /></p>
</div>
<div id="paris-montparnasse" class="section level1">
<h1>Paris Montparnasse</h1>
<p>Let me focus on Montparnasse which has lot of trains coming towards and departuring outwards according to the network map. Not all are cities of France according to my observations, where I can see Madrid, Zurich and Barcelona.</p>
</div>
<div id="chosen-city-with-total-number-of-trips" class="section level1">
<h1>Chosen City with Total Number of Trips</h1>
<p>Total number of trips from Paris Montparnasse station to other cities is noted here. Four years of data with more accuracy by months is considered in this plot. There is clear variation in this data for cities.</p>
<p>Close to 800 trips have been recorded towards the Bordeaux St Jean city but not clearly the same pattern for all years or months as well. Further, St Malo city has the lowest amount of trips compared to other cities in all fours but follows a centered pattern around the 100 mark.</p>
<pre class="r"><code>p&lt;-ggplot(subset(small_trains,departure_station==&quot;PARIS MONTPARNASSE&quot;),
       aes(x=str_wrap(arrival_station,20),y=total_num_trips,color=month))+
       geom_jitter()+coord_flip()+ labs(color=&quot;Month&quot;)+
       transition_time(year)+ease_aes(&quot;linear&quot;)+
       scale_y_continuous(breaks = seq(0,800,100),labels=seq(0,800,100))+
       xlab(&quot;Arrival Station&quot;)+ylab(&quot;Total Number of Trips&quot;)+
       ggtitle(&quot;Paris Montparnasse and its arrival Stations&quot; ,subtitle =&quot;Year :{frame_time}&quot;)

animate(p,nframes=4,fps=1)</code></pre>
<p><img src="/post/TidyTuesday2019/Week9/index_files/figure-html/Paris%20Montparnasse%20total%20num%20of%20trips-1.gif" /><!-- --></p>
</div>
<div id="chosen-city-with-average-journey-time" class="section level1">
<h1>Chosen City with Average Journey Time</h1>
<pre class="r"><code>p&lt;-ggplot(subset(small_trains,departure_station==&quot;PARIS MONTPARNASSE&quot;),
       aes(x=str_wrap(arrival_station,20),y=journey_time_avg,color=month))+
       geom_jitter()+coord_flip()+ labs(color=&quot;Month&quot;)+
       transition_time(year)+ease_aes(&quot;linear&quot;)+
       xlab(&quot;Arrival Station&quot;)+ylab(&quot;Average Journey Time&quot;)+
       ggtitle(&quot;Paris Montparnasse and its arrival Station&quot; ,subtitle =&quot;Year :{frame_time}&quot;)

animate(p,nframes=4,fps=1)</code></pre>
<p><img src="/post/TidyTuesday2019/Week9/index_files/figure-html/Paris%20Montparnasse%20Journey%20time%20average-1.gif" /><!-- --></p>
</div>
<div id="chosen-city-with-average-delay-with-all-departing" class="section level1">
<h1>Chosen City with Average Delay with All Departing</h1>
<pre class="r"><code>p&lt;-ggplot(subset(small_trains,departure_station==&quot;PARIS MONTPARNASSE&quot;),
       aes(x=str_wrap(arrival_station,20),y= avg_delay_all_departing,color=month))+
       geom_jitter()+coord_flip()+ labs(color=&quot;Month&quot;)+
       transition_time(year)+ease_aes(&quot;linear&quot;)+
       geom_hline(yintercept = 0,color=&quot;red&quot;)+
       xlab(&quot;Arrival Station&quot;)+ylab(&quot;Average Delay All Departing&quot;)+
       ggtitle(&quot;Paris Montparnasse and its arrival Station&quot; ,subtitle =&quot;Year :{frame_time}&quot;)

animate(p,nframes=4,fps=1)</code></pre>
<p><img src="/post/TidyTuesday2019/Week9/index_files/figure-html/Paris%20Montparnasse%20avg%20delay%20all%20departing-1.gif" /><!-- --></p>
</div>
<div id="chosen-city-with-average-delay-with-all-arriving" class="section level1">
<h1>Chosen City with Average Delay with All Arriving</h1>
<pre class="r"><code>p&lt;-ggplot(subset(small_trains,departure_station==&quot;PARIS MONTPARNASSE&quot;),
       aes(x=str_wrap(arrival_station,20),y=avg_delay_all_arriving,color=month))+
       geom_jitter()+coord_flip()+ labs(color=&quot;Month&quot;)+
       transition_time(year)+ease_aes(&quot;linear&quot;)+
       geom_hline(yintercept = 0,color=&quot;red&quot;)+
       xlab(&quot;Arrival Station&quot;)+ylab(&quot;Average Delay All Arriving&quot;)+
       ggtitle(&quot;Paris Montparnasse and its arrival Station&quot; ,subtitle =&quot;Year :{frame_time}&quot;)

animate(p,nframes=4,fps=1)</code></pre>
<p><img src="/post/TidyTuesday2019/Week9/index_files/figure-html/Paris%20Montparnasse%20avg%20delay%20all%20arriving-1.gif" /><!-- --></p>
</div>
<div id="chosen-city-with-number-of-late-departures" class="section level1">
<h1>Chosen City with Number of Late Departures</h1>
<pre class="r"><code>p&lt;-ggplot(subset(small_trains,departure_station==&quot;PARIS MONTPARNASSE&quot;),
       aes(x=str_wrap(arrival_station,20),y=num_late_at_departure,
           color=month))+
       geom_jitter()+coord_flip()+ labs(color=&quot;Month&quot;)+
       transition_time(year)+ease_aes(&quot;linear&quot;)+
       xlab(&quot;Arrival Station&quot;)+ylab(&quot;Number of Lates at Departure&quot;)+
       ggtitle(&quot;Paris Montparnasse and its arrival Station&quot; ,subtitle =&quot;Year :{frame_time}&quot;)

animate(p,nframes=4,fps=1)</code></pre>
<p><img src="/post/TidyTuesday2019/Week9/index_files/figure-html/Paris%20Montparnasse%20num%20late%20at%20departure-1.gif" /><!-- --></p>
</div>
<div id="chosen-city-with-number-of-late-arrivals" class="section level1">
<h1>Chosen City with Number of Late Arrivals</h1>
<pre class="r"><code>p&lt;-ggplot(subset(small_trains,departure_station==&quot;PARIS MONTPARNASSE&quot;),
       aes(x=str_wrap(arrival_station,20),y=num_arriving_late,
           color=month))+
       geom_jitter()+coord_flip()+ labs(color=&quot;Month&quot;)+
       transition_time(year)+ease_aes(&quot;linear&quot;)+
       xlab(&quot;Arrival Station&quot;)+ylab(&quot;Number of Lates at Arriving&quot;)+
       ggtitle(&quot;Paris Montparnasse and its arrival Station&quot; ,subtitle =&quot;Year :{frame_time}&quot;)

animate(p,nframes=4,fps=1)</code></pre>
<p><img src="/post/TidyTuesday2019/Week9/index_files/figure-html/Paris%20Montparnasse%20num%20arriving%20late-1.gif" /><!-- --></p>
</div>
<div id="departure-station-with-average-journey-time-and-total-number-of-trips" class="section level1">
<h1>Departure Station with Average Journey Time and Total Number of Trips</h1>
<pre class="r"><code>p&lt;-ggplot(small_trains,aes(x=journey_time_avg,y=total_num_trips,color=month))+
      geom_point()+transition_states(departure_station)+labs(color=&quot;Month&quot;)+
      ggtitle(&quot;Average Journey Time and Total Number of Trips&quot;,
              subtitle=&quot;Departure Station : {closest_state}&quot;)+
      scale_y_continuous(breaks=seq(0,900,50),labels=seq(0,900,50))+
      scale_x_continuous(breaks=seq(0,500,50),labels=seq(0,500,50))+  
      xlab(&quot;Average Journey Time&quot;)+ylab(&quot;Total Number of Trips&quot;)+
      shadow_mark()

animate(p,nframes=59,fps=1)</code></pre>
<p><img src="/post/TidyTuesday2019/Week9/index_files/figure-html/departure%20station%20with%20journey%20time%20avg%20and%20total%20num%20trips-1.gif" /><!-- --></p>
</div>
<div id="departure-station-with-average-delay-all-departing-and-number-of-late-at-departures" class="section level1">
<h1>Departure Station with Average Delay All Departing and Number of Late at Departures</h1>
<pre class="r"><code>p&lt;-ggplot(small_trains,aes(x=num_late_at_departure,y=avg_delay_all_departing,
                           color=month))+
      geom_point()+transition_states(departure_station)+labs(color=&quot;Month&quot;)+
      ggtitle(&quot;Average Delay at All Departing and Number of Lates at Departure&quot;,
              subtitle=&quot;Departure Station : {closest_state}&quot;)+
      geom_vline(xintercept = 0,color=&quot;red&quot;)+
      geom_hline(yintercept = 0,color=&quot;red&quot;)+
      scale_y_continuous(breaks=seq(-5,175,5),labels=seq(-5,175,5))+
      scale_x_continuous(breaks=seq(0,500,50),labels=seq(0,500,50))+  
      xlab(&quot;Number of Lates at Departure&quot;)+ylab(&quot;Average Delays at all Departing&quot;)+
      shadow_mark()

animate(p,nframes=59,fps=1)</code></pre>
<p><img src="/post/TidyTuesday2019/Week9/index_files/figure-html/departure%20station%20with%20Number%20of%20late%20and%20average%20Delay-1.gif" /><!-- --></p>
</div>
<div id="departure-station-with-average-delay-all-arriving-and-number-of-arriving-late" class="section level1">
<h1>Departure Station with Average Delay All Arriving and Number of Arriving Late</h1>
<pre class="r"><code>p&lt;-ggplot(small_trains,aes(x=num_arriving_late,y=avg_delay_all_arriving,
                           color=month))+
      geom_point()+transition_states(departure_station)+labs(color=&quot;Month&quot;)+
      ggtitle(&quot;Average Delay at All Arriving and Number of Lates at Arriving&quot;,
              subtitle=&quot;Departure Station : {closest_state}&quot;)+
      geom_vline(xintercept = 0,color=&quot;red&quot;)+
      geom_hline(yintercept = 0,color=&quot;red&quot;)+
      scale_y_continuous(breaks=seq(-150,40,5),labels=seq(-150,40,5))+
      scale_x_continuous(breaks=seq(0,250,25),labels=seq(0,250,25))+  
      xlab(&quot;Number of Lates at Arriving&quot;)+ylab(&quot;Average Delays at all Arriving&quot;)+
      shadow_mark()

animate(p,nframes=59,fps=1)</code></pre>
<p><img src="/post/TidyTuesday2019/Week9/index_files/figure-html/departure%20station%20with%20Number%20of%20Arriving%20late%20and%20average%20Delay%20arriving-1.gif" /><!-- --></p>
</div>
<div id="delayed-cause-and-delayed-number" class="section level1">
<h1>Delayed Cause and Delayed Number</h1>
<pre class="r"><code>small_trains %&gt;%
    mutate(delay_cause = str_remove(delay_cause,&quot;delay_cause_&quot;)) %&gt;%
ggplot(.,aes(x=delay_cause,y=delayed_number))+
      xlab(&quot;Delay Cause&quot;)+ylab(&quot;Delayed Number&quot;)+
      ggtitle(&quot;Delayed Causes and Delayed Number as percentage&quot;)+
      geom_jitter()+coord_flip()</code></pre>
<p><img src="/post/TidyTuesday2019/Week9/index_files/figure-html/Delayed%20No%20and%20Delayed%20cause-1.png" width="1152" /></p>
<p><em>THANK YOU</em></p>
</div>
